@using MyWeb.Infrastructure.Client;
@using Myweb.Domain.Common;
@model List<MyOrderDto>

<div class="preloader"></div>
<div id="main-wrapper">
    <!-- ======================= Top Breadcrubms ======================== -->
    <div class="gray py-3">
        <div class="container">
            <div class="row">
                <div class="colxl-12 col-lg-12 col-md-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">My Order</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- ======================= Top Breadcrubms ======================== -->
    <!-- ======================= Dashboard Detail ======================== -->
    <section class="middle">
        <div class="container">
            <div class="row align-items-start justify-content-between">
                <div class="col-12 col-md-12 col-lg-4 col-xl-4 text-center miliods">
                    <div class="d-block border rounded mfliud-bot">
                        <div class="dashboard_author px-2 py-5">
                            <div class="dash_auth_thumb circle p-1 border d-inline-flex mx-auto mb-2">
                            </div>

                            <div class="dash_caption">
                                <h4 class="fs-md ft-medium mb-0 lh-1"></h4>
                                @*<span class="text-muted smalls">Australia</span>*@
                            </div>
                        </div>
                        <div class="dashboard_author">totalPrice
                            <h4 class="px-3 py-2 mb-0 lh-2 gray fs-sm ft-medium text-muted text-uppercase text-left">Dashboard Navigation</h4>
                            <ul class="dahs_navbar">
                                <li><a href="#" class="active"><i class="lni lni-shopping-basket mr-2"></i>My Order</a></li>
                                <li><a href="@Url.Action("Profile", "Account")"><i class="lni lni-user mr-2"></i>Profile Info</a></li>
                                <li><a href="@Url.Action("ChangePassword","Account")"><i class="lni lni-key mr-2"></i>Change Password</a></li>
                                <li><a href="@Url.Action("Login","Account")"><i class="lni lni-power-switch mr-2"></i>Log Out</a></li>
                            </ul>
                        </div>
                    </div>

                </div>

                <div class="col-12 col-md-12 col-lg-8 col-xl-8">
                    @foreach (var item in Model)
                    {
                        var total = item.Details.Sum(x => x.Price);
                        <div class="ord_list_wrap border mb-4 mfliud">


                            <div class="ord_list_head gray d-flex align-items-center justify-content-between px-3 py-3">
                                <div class="olh_flex">
                                    <p class="m-0 p-0"><span class="text-muted">Order Number</span></p>
                                    <h6 class="mb-0 ft-medium">#@item.Id  - @item.OrderDate.ToString("dd/MM/yyyy HH:mm:ss")</h6>
                                </div>
                                <div class="olh_flex">
                                    <div>@item.StatusName</div>
                                </div>
                            </div>
                            <div class="ord_list_body text-left">
                                <!-- First Product -->
                                @foreach (var product in item.Details)
                                {
                                    <div class="row align-items-center justify-content-center m-0 py-4 br-bottom">
                                        <div class="col-xl-5 col-lg-5 col-md-5 col-12">
                                            <div class="cart_single d-flex align-items-start mfliud-bot">
                                                <div class="cart_selected_single_thumb">
                                                    <a href="#"><img src="@product.Image" width="75" class="img-fluid rounded" alt=""></a>
                                                </div>
                                                <div class="cart_single_caption pl-3">
                                                    <h4 class="product_title fs-sm ft-medium mb-1 lh-1">@product.Name</h4>
                                                    <p class="mb-2">
                                                        <span class="text-dark medium">Available</span>
                                                    </p>
                                                    @*<h4 class="fs-sm ft-bold mb-0 lh-1"></h4>*@
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-3 col-lg-3 col-md-3 col-6">
                                            <p class="mb-1 p-0"><span class="text-muted">Price</span></p>
                                            <div class="delv_status"><span class="ft-medium small text-danger bg-light-danger rounded px-3 py-1">$@product.Price</span></div>
                                        </div>
                                        <div class="col-xl-4 col-lg-4 col-md-4 col-6">
                                            <p class="mb-1 p-0"><span class="text-muted">Quantity</span></p>
                                            <h6 class="mb-0 ft-medium fs-sm">@product.Quantity</h6>
                                        </div>
                                    </div>
                                }


                            </div>
                            <div class="ord_list_footer d-flex align-items-center justify-content-between br-top px-3">

                                @{
                                    var classBtn = item.Status == ORDER_STATUS.Pending.Id ? "btn btn-sm btn-danger"
                                    : "btn btn-sm btn-default";
                                    var isCancel = item.Status == ORDER_STATUS.Pending.Id ? true
                                    : false;
                                }
                                <div onclick="CancelOrder('@item.Id', '@isCancel')" class="col-xl-3 col-lg-3 col-md-4 olf_flex text-left px-0 py-2 br-right">
                                    <a href="javascript:void(0);" class="@classBtn">
                                        <i class="ti-close mr-2"></i>Cancel Order
                                    </a>
                                </div>

                                <div class="col-xl-9 col-lg-9 col-md-8 pr-0 py-2 olf_flex d-flex align-items-center justify-content-between">
                                    <div class="olf_inner_right"><h5 class="mb-0 fs-sm ft-bold">Total: $@total</h5></div>
                                </div>
                            </div>
                        </div>



                    }




                </div>
            </div>
        </div>
    </section>
</div>



<script>
    function CancelOrder(orderId, isCancel) {
        if (isCancel == 'False') {
            return;
        }
        Swal.fire({
            title: 'Do you want to cancel an order?',
            text: "If you cancel, you cannot restore!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'OK'
        }).then((result) => {
            if (result.isConfirmed) {
                axios.post('/Account/CancelOrder', {
                    'orderId': orderId
                }, {

                    headers: {
                        'content-type': 'application/x-www-form-urlencoded'
                    }
                })
                    .then(function (response) {
                        window.location.reload()
                    })
            }
        })

    }
</script>